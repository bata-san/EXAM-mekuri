<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>âš¡ è¶…é«˜é€Ÿè¨˜æ†¶è¡“ - 1æ™‚é–“å®Œå…¨ãƒã‚¹ã‚¿ãƒ¼</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --card-bg: #2d2d2d;
            --primary-color: #00aaff;
            --success-color: #28a745;
            --danger-color: #ff4757;
            --warning-color: #fbc531;
            --text-color: #e0e0e0;
            --sub-text-color: #9e9e9e;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --border-color: #424242;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Dashboard Screen */
        #dashboard {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        #dashboard h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 32px;
        }

        #dashboard p {
            color: var(--sub-text-color);
            margin-top: 0;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 400px;
            margin: 20px 0;
        }

        .stat-box {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .stat-box .label {
            font-size: 14px;
            color: var(--sub-text-color);
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 28px;
            font-weight: bold;
        }

        #review-value {
            color: var(--warning-color);
        }

        #mastered-value {
            color: var(--success-color);
        }

        #progress-percentage {
            color: var(--primary-color);
        }

        /* Timer Container */
        .timer-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }

        .timer-box {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            color: white;
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .timer-label {
            font-size: 12px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .timer-value {
            font-size: 24px;
            font-weight: bold;
        }

        /* Speed Learning Indicators */
        .speed-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .ultra-fast {
            background: var(--danger-color);
        }

        #remaining-value {
            color: var(--warning-color);
        }

        #memorized-value {
            color: var(--success-color);
        }

        #memory-percentage {
            color: var(--primary-color);
        }

        .start-btn {
            width: 100%;
            max-width: 400px;
            padding: 18px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 12px;
            background-color: var(--primary-color);
            color: white;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .start-btn:hover {
            filter: brightness(1.1);
        }

        .start-btn:active {
            transform: scale(0.98);
        }

        /* Study Screen */
        #study-screen {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .study-header {
            padding: 15px;
            text-align: center;
            background: var(--card-bg);
            box-shadow: 0 2px 4px var(--shadow-color);
            z-index: 10;
            position: relative;
        }

        .progress-info {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .speed-mode-indicator {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--danger-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Card Area */
        .card-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .card {
            width: 100%;
            max-width: 450px;
            height: 480px;
            perspective: 1000px;
            user-select: none;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.5s ease, opacity 0.3s ease, transform 0.3s ease;
            border-radius: 16px;
            box-shadow: 0 8px 30px var(--shadow-color);
        }

        .card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            box-sizing: border-box;
            background: var(--card-bg);
            text-align: center;
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .topic-tag {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 170, 255, 0.2);
            color: var(--primary-color);
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .question {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.5;
        }

        .answer {
            font-size: 24px;
            font-weight: bold;
            line-height: 1.4;
        }

        /* Evaluation UI */
        .eval-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            border-top: 3px solid var(--primary-color);
        }

        .eval-container.show {
            transform: translateY(0);
        }

        .eval-step {
            display: none;
        }

        .eval-step.active {
            display: block;
            text-align: center;
        }

        .eval-step p {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .eval-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .eval-btn {
            flex: 1;
            max-width: 200px;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 12px;
            border: none;
            transition: all 0.2s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .eval-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .eval-btn:active {
            transform: scale(0.98);
        }

        .eval-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-knew {
            background-color: var(--success-color);
            color: white;
        }

        .btn-didnt-know {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-confident {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-not-confident {
            background-color: var(--warning-color);
            color: white;
        }

        #back-to-dash {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 200;
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        strong {
            color: #ffab40;
        }

        /* Scientific Memory Enhancement Features */
        .recall-test {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 10px 0;
            animation: slideInUp 0.5s ease-out;
        }

        .recall-prompt {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .recall-question {
            font-size: 16px;
            margin: 15px 0;
            line-height: 1.5;
        }

        .recall-hint {
            font-size: 12px;
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        .recall-benefit {
            font-size: 11px;
            margin-top: 10px;
            opacity: 0.7;
            font-style: italic;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }

        .self-explanation-prompt {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid #ff6b9d;
            animation: slideInUp 0.3s ease-out;
            transition: all 0.3s ease;
        }

        .explanation-header {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explanation-text {
            font-size: 15px;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .explanation-timer {
            font-size: 12px;
            opacity: 0.7;
            text-align: center;
        }

        .timer-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #c44569);
            width: 0%;
            transition: width 0.1s ease;
        }

        @keyframes timer-progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Memory Progress Indicators */
        .memory-level-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            z-index: 5;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .memory-level-0 { background-color: #ff4444; }
        .memory-level-1 { background-color: #ff8800; }
        .memory-level-2 { background-color: #44aa44; }
        .memory-level-3 { background-color: #0088ff; }

        /* Feedback Messages */
        .feedback-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 2000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .feedback-message.success {
            background: var(--success-color);
            color: white;
        }

        .feedback-message.info {
            background: var(--primary-color);
            color: white;
        }

        .feedback-message.warning {
            background: var(--warning-color);
            color: white;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .study-header {
                padding: 10px;
            }
            
            .eval-btns {
                flex-direction: column;
                gap: 15px;
            }
            
            .eval-btn {
                min-height: 50px;
            }
            
            .self-explanation-prompt {
                margin: 10px 0;
                padding: 15px;
            }
            
            .explanation-header {
                font-size: 16px;
            }
            
            .explanation-text {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Dashboard Screen -->
        <div id="dashboard">
            <h1>âš¡ è¶…é«˜é€Ÿè¨˜æ†¶è¡“</h1>
            <p>ç§‘å­¦çš„é–“éš”åå¾©ã§è¶…ã‚¹ãƒ”ãƒ¼ãƒ‰æš—è¨˜ãƒã‚¹ã‚¿ãƒ¼</p>
            <div class="timer-container">
                <div class="timer-box">
                    <div class="timer-label">å­¦ç¿’æ™‚é–“</div>
                    <div class="timer-value" id="study-timer">00:00</div>
                </div>
                <div class="timer-box">
                    <div class="timer-label">ç›®æ¨™æ™‚é–“</div>
                    <div class="timer-value">60:00</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="label">å…¨å•é¡Œæ•°</div>
                    <div class="value" id="total-value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">æ®‹ã‚Šå•é¡Œ</div>
                    <div class="value" id="remaining-value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">è¨˜æ†¶æ¸ˆã¿</div>
                    <div class="value" id="memorized-value">0</div>
                </div>
                <div class="stat-box">
                    <div class="label">è¨˜æ†¶ç‡</div>
                    <div class="value" id="memory-percentage">0%</div>
                </div>
            </div>
            <button class="start-btn" id="ultra-speed-btn">ğŸš€ è¶…é«˜é€Ÿå­¦ç¿’é–‹å§‹</button>
            <button class="start-btn" id="review-cycle-btn" style="background-color: var(--warning-color);">ğŸ”„ é–“éš”åå¾©å¾©ç¿’</button>
            <button class="start-btn" id="reset-progress"
                style="margin-top:20px; background-color: #6c757d; font-size: 14px;">å­¦ç¿’è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <!-- Study Screen -->
        <div id="study-screen">
            <div class="study-header">
                <div class="progress-info" id="progress-info"></div>
                <div class="speed-mode-indicator">è¶…é«˜é€Ÿãƒ¢ãƒ¼ãƒ‰</div>
            </div>
            <div class="card-area" id="card-area">
                <div class="card" id="card">
                    <div class="memory-level-indicator" id="memory-indicator"></div>
                    <div class="card-inner" id="card-inner">
                        <div class="card-face card-front">
                            <span class="topic-tag" id="front-topic-tag"></span>
                            <div class="speed-indicator" id="speed-indicator">3ç§’ä»¥å†…</div>
                            <p class="question" id="question"></p>
                        </div>
                        <div class="card-face card-back">
                            <span class="topic-tag" id="back-topic-tag"></span>
                            <p class="answer" id="answer"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="back-to-dash" title="ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹">âœ•</div>

            <div class="eval-container" id="eval-container">
                <div class="eval-step" id="eval-step-1">
                    <p>ç¬æ™‚ã«ç­”ãˆãŒæµ®ã‹ã³ã¾ã—ãŸã‹ï¼Ÿ</p>
                    <div class="eval-btns">
                        <button class="eval-btn btn-didnt-know" id="eval-unknown">åˆ†ã‹ã‚‰ãªã„</button>
                        <button class="eval-btn btn-knew" id="eval-instant">ç¬æ™‚ã«æµ®ã‹ã‚“ã </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const initialCardData =
            [
                
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "15ä¸–ç´€æœ«ã‹ã‚‰16ä¸–ç´€ã«ã‹ã‘ã¦ã€ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘äººãŒæ´»ç™ºã«è¡Œã£ãŸæµ·å¤–æ¢æ¤œãƒ»æ¤æ°‘æ´»å‹•ã‚’ä½•ã¨å‘¼ã¶ã‹ï¼Ÿ", "a": "<strong>å¤§èˆªæµ·æ™‚ä»£</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "å¤§èˆªæµ·æ™‚ä»£ã«æœ€åˆã«æµ·å¤–é€²å‡ºã‚’æœãŸã—ãŸã‚¤ãƒ™ãƒªã‚¢åŠå³¶ã®2å›½ã¯ï¼Ÿ", "a": "<strong>ãƒãƒ«ãƒˆã‚¬ãƒ«ã¨ã‚¹ãƒšã‚¤ãƒ³</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "ãƒãƒ«ãƒˆã‚¬ãƒ«ã®ãƒ´ã‚¡ã‚¹ã‚³ãƒ»ãƒ€ãƒ»ã‚¬ãƒãŒåˆ°é”ã—ãŸã‚¤ãƒ³ãƒ‰ã®æ¸¯ã¯ï¼Ÿ", "a": "<strong>ã‚«ãƒªã‚«ãƒƒãƒˆ</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "ã‚³ãƒ­ãƒ³ãƒ–ã‚¹ãŒåˆ°é”ã—ãŸæ–°å¤§é™¸ã®åœ°åã¯ï¼Ÿ", "a": "<strong>ã‚µãƒ³ã‚µãƒ«ãƒãƒ‰ãƒ«å³¶ï¼ˆè¥¿ã‚¤ãƒ³ãƒ‰è«¸å³¶ã®ä¸€éƒ¨ï¼‰</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "ä¸–ç•Œä¸€å‘¨ã‚’é”æˆã—ãŸãƒã‚¼ãƒ©ãƒ³ã®èˆ¹éšŠãŒç™ºè¦‹ã—ãŸæµ·å³¡ã¯ï¼Ÿ", "a": "<strong>ãƒã‚¼ãƒ©ãƒ³æµ·å³¡</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "ãƒ¡ã‚­ã‚·ã‚³ã®ã‚¢ã‚¹ãƒ†ã‚«å¸å›½ã‚’æ»…ã¼ã—ãŸã‚¹ãƒšã‚¤ãƒ³ã®ã‚³ãƒ³ã‚­ã‚¹ã‚¿ãƒ‰ãƒ¼ãƒ«ã¯ï¼Ÿ", "a": "<strong>ã‚³ãƒ«ãƒ†ã‚¹</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "ãƒšãƒ«ãƒ¼ã®ã‚¤ãƒ³ã‚«å¸å›½ã‚’æ»…ã¼ã—ãŸã‚¹ãƒšã‚¤ãƒ³ã®ã‚³ãƒ³ã‚­ã‚¹ã‚¿ãƒ‰ãƒ¼ãƒ«ã¯ï¼Ÿ", "a": "<strong>ãƒ”ã‚µãƒ­</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "å¤§èˆªæµ·æ™‚ä»£ã«ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã«ã‚‚ãŸã‚‰ã•ã‚ŒãŸæ–°ä¸–ç•Œã®ä½œç‰©ã¯ï¼Ÿ", "a": "<strong>ã‚¸ãƒ£ã‚¬ã‚¤ãƒ¢ã€ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·ã€ãƒˆãƒãƒˆã€ã‚¿ãƒã‚³ãªã©</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "å¤§èˆªæµ·æ™‚ä»£ã«ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã‹ã‚‰æ–°ä¸–ç•Œã¸ã‚‚ãŸã‚‰ã•ã‚ŒãŸå®¶ç•œã¯ï¼Ÿ", "a": "<strong>é¦¬ã€ç‰›ã€è±šãªã©</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "å¤§èˆªæµ·æ™‚ä»£ã«ã‚ˆã‚Šã€å•†æ¥­ã®ä¸­å¿ƒãŒåœ°ä¸­æµ·ã‹ã‚‰å¤§è¥¿æ´‹æ²¿å²¸ã«ç§»ã£ãŸç¾è±¡ã‚’ä½•ã¨å‘¼ã¶ã‹ï¼Ÿ", "a": "<strong>å•†æ¥­é©å‘½</strong>" },
                { "topic": "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ä¸–ç•Œ", "q": "å•†æ¥­é©å‘½æœŸã«ã€éŠ€ã®ä¾›çµ¦é‡ãŒå¢—å¤§ã—ã€ç‰©ä¾¡ãŒé«˜é¨°ã—ãŸç¾è±¡ã¯ï¼Ÿ", "a": "<strong>ä¾¡æ ¼é©å‘½</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "16ä¸–ç´€ã«ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã§èµ·ã“ã£ãŸã‚«ãƒˆãƒªãƒƒã‚¯æ•™ä¼šã¸ã®æ‰¹åˆ¤ã¨æ”¹é©é‹å‹•ã‚’ä½•ã¨å‘¼ã¶ã‹ï¼Ÿ", "a": "<strong>å®—æ•™æ”¹é©</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "ãƒ«ã‚¿ãƒ¼ãŒç™ºè¡¨ã—ãŸã€æ•™ä¼šã®è…æ•—ã‚’æ‰¹åˆ¤ã—ãŸæ–‡æ›¸ã¯ï¼Ÿ", "a": "<strong>95ãƒ¶æ¡ã®è«–é¡Œ</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "ãƒ«ã‚¿ãƒ¼ã‚’ä¿è­·ã—ã€å®—æ•™æ”¹é©ã®æ¨é€²ã«è²¢çŒ®ã—ãŸãƒ‰ã‚¤ãƒ„ã®è«¸ä¾¯ã¯ï¼Ÿ", "a": "<strong>ã‚¶ã‚¯ã‚»ãƒ³é¸å¸ä¾¯ãƒ•ãƒªãƒ¼ãƒ‰ãƒªãƒ’3ä¸–</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "ãƒ«ã‚¿ãƒ¼æ´¾ã‚’æ”¯æŒã—ãŸãƒ‰ã‚¤ãƒ„ã®è«¸ä¾¯ã‚„éƒ½å¸‚ãŒã€çš‡å¸ã«æå‡ºã—ãŸæŠ—è­°æ–‡ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸå‘¼ã³åã¯ï¼Ÿ", "a": "<strong>ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒˆ</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "ãƒ«ã‚¿ãƒ¼ã®å®—æ•™æ”¹é©ã‚’æ­£çµ±ã¨èªã‚ãŸ1555å¹´ã®å’Œè­°ã¯ï¼Ÿ", "a": "<strong>ã‚¢ã‚¦ã‚¯ã‚¹ãƒ–ãƒ«ã‚¯ã®å®—æ•™å’Œè­°</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "äºˆå®šèª¬ã‚’å”±ãˆã€ã‚¸ãƒ¥ãƒãƒ¼ãƒ´ã§ç¥æ¨©æ”¿æ²»ã‚’è¡Œã£ãŸäººç‰©ã¯ï¼Ÿ", "a": "<strong>ã‚«ãƒ«ãƒ´ã‚¡ãƒ³</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "ã‚¤ã‚®ãƒªã‚¹ã§å›½ç‹ã‚’é¦–é•·ã¨ã™ã‚‹æ•™ä¼šã‚’è¨­ç«‹ã—ãŸäººç‰©ã¯ï¼Ÿ", "a": "<strong>ãƒ˜ãƒ³ãƒª8ä¸–</strong>" },
                { "topic": "å®—æ•™æ”¹é©", "q": "ã‚¤ã‚®ãƒªã‚¹ã§è¨­ç«‹ã•ã‚ŒãŸæ•™ä¼šã‚’ä½•ã¨å‘¼ã¶ã‹ï¼Ÿ", "a": "<strong>ã‚¤ã‚®ãƒªã‚¹å›½æ•™ä¼š</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "å›½ç‹ãŒå¼·å¤§ãªæ¨©åŠ›ã‚’æŒã¡ã€å›½å®¶ã‚’çµ±æ²»ã™ã‚‹æ”¿æ²»ä½“åˆ¶ã¯ï¼Ÿ", "a": "<strong>çµ¶å¯¾ç‹æ”¿</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "ãƒ•ãƒ©ãƒ³ã‚¹çµ¶å¯¾ç‹æ”¿ã®æœ€ç››æœŸã®å›½ç‹ã¯ï¼Ÿ", "a": "<strong>ãƒ«ã‚¤14ä¸–</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "ãƒ«ã‚¤14ä¸–ãŒå»ºè¨­ã—ãŸè±ªè¯ãªå®®æ®¿ã¯ï¼Ÿ", "a": "<strong>ãƒ´ã‚§ãƒ«ã‚µã‚¤ãƒ¦å®®æ®¿</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "ãƒ«ã‚¤14ä¸–ã®é‡å•†ä¸»ç¾©æ”¿ç­–ã‚’æ¨é€²ã—ãŸè²¡å‹™ç·ç›£ã¯ï¼Ÿ", "a": "<strong>ã‚³ãƒ«ãƒ™ãƒ¼ãƒ«</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "ã‚¤ã‚®ãƒªã‚¹ã§ã‚¹ãƒ†ãƒ¥ã‚¢ãƒ¼ãƒˆæœãŒçµ¶å¯¾ç‹æ”¿ã‚’å¿—å‘ã—ã€è­°ä¼šã¨å¯¾ç«‹ã—ãŸé©å‘½ã¯ï¼Ÿ", "a": "<strong>ãƒ”ãƒ¥ãƒ¼ãƒªã‚¿ãƒ³é©å‘½</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "ãƒ”ãƒ¥ãƒ¼ãƒªã‚¿ãƒ³é©å‘½ã‚’ä¸»å°ã—ãŸäººç‰©ã¯ï¼Ÿ", "a": "<strong>ã‚¯ãƒ­ãƒ ã‚¦ã‚§ãƒ«</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "ã‚¤ã‚®ãƒªã‚¹ã§åèª‰é©å‘½ã«ã‚ˆã‚Šæˆç«‹ã—ãŸæ”¿æ²»ä½“åˆ¶ã¯ï¼Ÿ", "a": "<strong>ç«‹æ†²å›ä¸»åˆ¶</strong>" },
                { "topic": "çµ¶å¯¾ç‹æ”¿", "q": "åèª‰é©å‘½ã§å›½ç‹ãŒæ‰¿èªã—ãŸã€è­°ä¼šã®æ¨©åˆ©ã‚’å®šã‚ãŸæ³•å¾‹ã¯ï¼Ÿ", "a": "<strong>æ¨©åˆ©ã®ç« å…¸</strong>" },
                { "topic": "ä¸»æ¨©å›½å®¶ä½“åˆ¶", "q": "ä¸»æ¨©å›½å®¶é–“ã®å‹¢åŠ›å‡è¡¡ã«ã‚ˆã£ã¦å›½éš›ç§©åºã‚’ä¿ã¤è€ƒãˆæ–¹ã¯ï¼Ÿ", "a": "<strong>ãƒãƒ©ãƒ³ã‚¹ãƒ»ã‚ªãƒ–ãƒ»ãƒ‘ãƒ¯ãƒ¼</strong>" },
                { "topic": "ä¸»æ¨©å›½å®¶ä½“åˆ¶", "q": "ä¸‰åå¹´æˆ¦äº‰ã®è¬›å’Œæ¡ç´„ã§ã€ä¸»æ¨©å›½å®¶ä½“åˆ¶ãŒç¢ºç«‹ã—ãŸã¨ã•ã‚Œã‚‹æ¡ç´„ã¯ï¼Ÿ", "a": "<strong>ã‚¦ã‚§ã‚¹ãƒˆãƒ•ã‚¡ãƒªã‚¢æ¡ç´„</strong>" },
                { "topic": "17ãƒ»18ä¸–ç´€", "q": "ã‚¤ã‚®ãƒªã‚¹ã¨ãƒ•ãƒ©ãƒ³ã‚¹ãŒæ¤æ°‘åœ°ã‚’ã‚ãã£ã¦äº‰ã£ãŸæˆ¦äº‰ã¯ï¼Ÿ", "a": "<strong>ä¸ƒå¹´æˆ¦äº‰</strong>" },
                { "topic": "17ãƒ»18ä¸–ç´€", "q": "ä¸ƒå¹´æˆ¦äº‰ã®çµæœã€ãƒ•ãƒ©ãƒ³ã‚¹ãŒã‚¤ã‚®ãƒªã‚¹ã«ã‚«ãƒŠãƒ€ã‚„ã‚¤ãƒ³ãƒ‰ã«ãŠã‘ã‚‹æ¤æ°‘åœ°ã®æ¨©åˆ©ã‚’è­²æ¸¡ã—ãŸæ¡ç´„ã¯ï¼Ÿ", "a": "<strong>ãƒ‘ãƒªæ¡ç´„</strong>" },
                { "topic": "å•“è’™æ€æƒ³", "q": "18ä¸–ç´€ã«ãƒ•ãƒ©ãƒ³ã‚¹ã‚’ä¸­å¿ƒã«åºƒã¾ã£ãŸã€ç†æ€§ã‚’é‡ã‚“ã˜ã‚‹æ€æƒ³ã¯ï¼Ÿ", "a": "<strong>å•“è’™æ€æƒ³</strong>" },
                { "topic": "å•“è’™æ€æƒ³", "q": "ã€æ³•ã®ç²¾ç¥ã€ã§æ¨©åŠ›åˆ†ç«‹ã‚’èª¬ã„ãŸæ€æƒ³å®¶ã¯ï¼Ÿ", "a": "<strong>ãƒ¢ãƒ³ãƒ†ã‚¹ã‚­ãƒ¥ãƒ¼</strong>" },
                { "topic": "å•“è’™æ€æƒ³", "q": "ã€ç¤¾ä¼šå¥‘ç´„è«–ã€ã§äººæ°‘ä¸»æ¨©ã‚’èª¬ã„ãŸæ€æƒ³å®¶ã¯ï¼Ÿ", "a": "<strong>ãƒ«ã‚½ãƒ¼</strong>" },
                { "topic": "å•“è’™æ€æƒ³", "q": "ã€ç™¾ç§‘å…¨æ›¸ã€ã‚’ç·¨çº‚ã—ãŸå•“è’™æ€æƒ³å®¶ã¯ï¼Ÿ", "a": "<strong>ãƒ‡ã‚£ãƒ‰ãƒ­</strong>" },
                { "topic": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½", "q": "ã‚¤ã‚®ãƒªã‚¹ã®åŒ—ç±³æ¤æ°‘åœ°ãŒç‹¬ç«‹ã‚’å®£è¨€ã—ãŸå‡ºæ¥äº‹ã¯ï¼Ÿ", "a": "<strong>ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½</strong>" },
                { "topic": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½", "q": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½ã®ç™ºç«¯ã¨ãªã£ãŸäº‹ä»¶ã¯ï¼Ÿ", "a": "<strong>ãƒœã‚¹ãƒˆãƒ³èŒ¶ä¼šäº‹ä»¶</strong>" },
                { "topic": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½", "q": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹å®£è¨€ã‚’èµ·è‰ã—ãŸäººç‰©ã¯ï¼Ÿ", "a": "<strong>ã‚¸ã‚§ãƒ•ã‚¡ã‚½ãƒ³</strong>" },
                { "topic": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½", "q": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹æˆ¦äº‰ã‚’æŒ‡æ®ã—ãŸç·å¸ä»¤å®˜ã¯ï¼Ÿ", "a": "<strong>ãƒ¯ã‚·ãƒ³ãƒˆãƒ³</strong>" },
                { "topic": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½", "q": "ã‚¢ãƒ¡ãƒªã‚«ç‹¬ç«‹é©å‘½ã§ã€ã‚¤ã‚®ãƒªã‚¹ã‚’æ”¯æ´ã—ãŸå›½ã¯ï¼Ÿ", "a": "<strong>ãƒ•ãƒ©ãƒ³ã‚¹ã€ã‚¹ãƒšã‚¤ãƒ³ã€ã‚ªãƒ©ãƒ³ãƒ€ãªã©</strong>" },
                { "topic": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½", "q": "1789å¹´ã«ãƒ•ãƒ©ãƒ³ã‚¹ã§èµ·ã“ã£ãŸå¸‚æ°‘é©å‘½ã¯ï¼Ÿ", "a": "<strong>ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½</strong>" },
                { "topic": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½", "q": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½ã®ç™ºç«¯ã¨ãªã£ãŸå‡ºæ¥äº‹ã¯ï¼Ÿ", "a": "<strong>ãƒã‚¹ãƒ†ã‚£ãƒ¼ãƒ¦ç‰¢ç„è¥²æ’ƒ</strong>" },
                { "topic": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½", "q": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½ã§ç™ºè¡¨ã•ã‚ŒãŸã€äººé–“ã®è‡ªç”±ã¨å¹³ç­‰ã‚’ã†ãŸã£ãŸå®£è¨€ã¯ï¼Ÿ", "a": "<strong>äººæ¨©å®£è¨€</strong>" },
                { "topic": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½", "q": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½æœŸã®æ€¥é€²çš„ãªæ”¿æ²»å®¶ã§ã€ææ€–æ”¿æ²»ã‚’è¡Œã£ãŸäººç‰©ã¯ï¼Ÿ", "a": "<strong>ãƒ­ãƒ™ã‚¹ãƒ”ã‚¨ãƒ¼ãƒ«</strong>" },
                { "topic": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½", "q": "ãƒ•ãƒ©ãƒ³ã‚¹é©å‘½å¾Œã€ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã‚’å¸­å·»ã—ãŸè»äº‹æŒ‡å°è€…ã¯ï¼Ÿ", "a": "<strong>ãƒŠãƒãƒ¬ã‚ªãƒ³</strong>" },
                { "topic": "ç”£æ¥­é©å‘½", "q": "18ä¸–ç´€å¾ŒåŠã«ã‚¤ã‚®ãƒªã‚¹ã§å§‹ã¾ã£ãŸã€æ©Ÿæ¢°åŒ–ã«ã‚ˆã‚‹ç”Ÿç”£é©å‘½ã¯ï¼Ÿ", "a": "<strong>ç”£æ¥­é©å‘½</strong>" },
                { "topic": "ç”£æ¥­é©å‘½", "q": "ç”£æ¥­é©å‘½ã§æœ€åˆã«é©æ–°ãŒèµ·ã“ã£ãŸç”£æ¥­éƒ¨é–€ã¯ï¼Ÿ", "a": "<strong>ç¶¿å·¥æ¥­</strong>" },
                { "topic": "ç”£æ¥­é©å‘½", "q": "è’¸æ°—æ©Ÿé–¢ã‚’æ”¹è‰¯ã—ã€å®Ÿç”¨åŒ–ã—ãŸäººç‰©ã¯ï¼Ÿ", "a": "<strong>ã‚¸ã‚§ãƒ¼ãƒ ã‚ºãƒ»ãƒ¯ãƒƒãƒˆ</strong>" },
                { "topic": "ç”£æ¥­é©å‘½", "q": "ç”£æ¥­é©å‘½ã«ã‚ˆã‚Šå½¢æˆã•ã‚ŒãŸã€å·¥å ´åŠ´åƒè€…éšç´šã‚’ä½•ã¨å‘¼ã¶ã‹ï¼Ÿ", "a": "<strong>ãƒ—ãƒ­ãƒ¬ã‚¿ãƒªã‚¢ãƒ¼ãƒˆ</strong>" }
            ];

        document.addEventListener('DOMContentLoaded', () => {
            const App = {
                state: {
                    cardData: [],
                    cardMemory: [], // { id, level, lastReview, nextReview }
                    studyQueue: [],
                    currentIndex: 0,
                    currentCard: null,
                    startTime: null,
                    studyTimer: null,
                    currentMode: 'ultra', // 'ultra' or 'spaced'
                },
                dom: {},
                config: {
                    STORAGE_KEY: 'ultraSpeedMemory_v1',
                    // é–“éš”åå¾©ã®ç§‘å­¦çš„é–“éš”ï¼ˆåˆ†ï¼‰
                    SPACED_INTERVALS: [2, 10, 30, 60, 240], // 2åˆ†ã€10åˆ†ã€30åˆ†ã€1æ™‚é–“ã€4æ™‚é–“å¾Œ
                    MEMORY_LEVELS: {
                        UNKNOWN: 0,      // æœªçŸ¥ï¼šèµ¤è‰²
                        LEARNING: 1,     // å­¦ç¿’ä¸­ï¼šé»„è‰²
                        FAMILIAR: 2,     // æ…£ã‚ŒãŸï¼šç·‘è‰²  
                        MEMORIZED: 3     // è¨˜æ†¶æ¸ˆã¿ï¼šé’è‰²
                    },
                    // é«˜é€Ÿå­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼è¨­å®šï¼‰
                    ULTRA_SPEED_DURATION: 8000,  // 8ç§’ã§ãƒ•ãƒªãƒƒãƒ—ï¼ˆèª­ã¿3ç§’ï¼‹è€ƒãˆã‚‹5ç§’ï¼‰
                    ANSWER_DISPLAY_TIME: 3000,   // 3ç§’é–“ç­”ãˆã‚’è¡¨ç¤ºï¼ˆå¾©ç¿’æ™‚é–“ï¼‰
                    THINKING_TIME: 5000,         // 5ç§’ã®æ€è€ƒæ™‚é–“
                    // ç§‘å­¦çš„æš—è¨˜æ”¯æ´è¨­å®šï¼ˆã‚¨ãƒ“ãƒ³ã‚°ãƒã‚¦ã‚¹ã®å¿˜å´æ›²ç·šãƒ»åˆ†æ•£å­¦ç¿’åŠ¹æœï¼‰
                    RECALL_TEST_PROBABILITY: 0.4, // 40%ã®ç¢ºç‡ã§æ€ã„å‡ºã—ãƒ†ã‚¹ãƒˆ
                    SELF_EXPLANATION_PROMPTS: [
                        "ğŸ¤” ã“ã®ç­”ãˆã®ç†ç”±ã‚„èƒŒæ™¯ã‚’30ç§’ã§èª¬æ˜ã—ã¦ã¿ã¦ãã ã•ã„",
                        "ğŸ“ ã“ã®å ´æ‰€ã®åœ°ç†çš„ç‰¹å¾´ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
                        "ğŸ”— ä»–ã®åœ°åŸŸã‚„å‡ºæ¥äº‹ã¨ã®é–¢é€£æ€§ã‚’è€ƒãˆã¦ã¿ã¦ãã ã•ã„",
                        "ğŸ’¡ è¦šãˆã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¿ã¦ãã ã•ã„",
                        "ğŸ“š ã“ã®å•é¡Œã®ãƒã‚¤ãƒ³ãƒˆã‚’è‡ªåˆ†ã®è¨€è‘‰ã§è¦ç´„ã—ã¦ãã ã•ã„"
                    ],
                    // è¦–è¦šçš„è¨˜æ†¶æ”¯æ´ï¼ˆãƒ‡ãƒ¥ã‚¢ãƒ«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç†è«–ï¼‰
                    VISUAL_CUES: {
                        DIFFICULTY_COLORS: {
                            easy: '#4CAF50',   // ç·‘ï¼šç°¡å˜
                            medium: '#FF9800', // ã‚ªãƒ¬ãƒ³ã‚¸ï¼šæ™®é€š
                            hard: '#f44336'    // èµ¤ï¼šé›£ã—ã„
                        },
                        MEMORY_PROGRESS_COLORS: ['#ff4444', '#ff8800', '#44aa44', '#0088ff']
                    },
                    // è¨˜æ†¶å®šç€ä¿ƒé€²è¨­å®š
                    ELABORATIVE_REHEARSAL_CHANCE: 0.3, // 30%ã§è©³ç´°ãƒªãƒãƒ¼ã‚µãƒ«
                    CONFIDENCE_TRACKING: true,          // è‡ªä¿¡åº¦è¿½è·¡
                    DISTRIBUTED_PRACTICE_REMINDERS: true // åˆ†æ•£å­¦ç¿’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
                },

                init() {
                    this.cacheDOM();
                    this.state.cardData = initialCardData.map((card, index) => ({ ...card, id: index }));
                    this.loadMemoryData();
                    this.updateDashboard();
                    this.bindEvents();
                    this.showDashboard();
                },

                cacheDOM() {
                    this.dom = {
                        dashboard: document.getElementById('dashboard'),
                        studyScreen: document.getElementById('study-screen'),
                        progressInfo: document.getElementById('progress-info'),
                        studyTimer: document.getElementById('study-timer'),
                        card: document.getElementById('card'),
                        cardInner: document.getElementById('card-inner'),
                        frontTopicTag: document.getElementById('front-topic-tag'),
                        backTopicTag: document.getElementById('back-topic-tag'),
                        question: document.getElementById('question'),
                        answer: document.getElementById('answer'),
                        speedIndicator: document.getElementById('speed-indicator'),
                        memoryIndicator: document.getElementById('memory-indicator'),
                        evalContainer: document.getElementById('eval-container'),
                        evalStep1: document.getElementById('eval-step-1'),
                        evalUnknownBtn: document.getElementById('eval-unknown'),
                        evalInstantBtn: document.getElementById('eval-instant'),
                        ultraSpeedBtn: document.getElementById('ultra-speed-btn'),
                        reviewCycleBtn: document.getElementById('review-cycle-btn'),
                        resetProgressBtn: document.getElementById('reset-progress'),
                        backToDashBtn: document.getElementById('back-to-dash'),
                    };
                },

                bindEvents() {
                    this.dom.ultraSpeedBtn.addEventListener('click', () => this.startUltraSpeed());
                    this.dom.reviewCycleBtn.addEventListener('click', () => this.startSpacedReview());
                    this.dom.resetProgressBtn.addEventListener('click', () => this.resetProgress());
                    this.dom.backToDashBtn.addEventListener('click', () => this.showDashboard());
                    this.dom.card.addEventListener('click', () => this.flipCard());
                    
                    // è©•ä¾¡ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç¢ºå®Ÿã«è¨­å®šï¼ˆè¤‡æ•°å›è¨­å®šã‚’é˜²ãï¼‰
                    this.bindEvaluationButtons();
                },

                bindEvaluationButtons() {
                    // æ—¢å­˜ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰å†è¨­å®š
                    const newUnknownBtn = this.dom.evalUnknownBtn.cloneNode(true);
                    const newInstantBtn = this.dom.evalInstantBtn.cloneNode(true);
                    
                    this.dom.evalUnknownBtn.parentNode.replaceChild(newUnknownBtn, this.dom.evalUnknownBtn);
                    this.dom.evalInstantBtn.parentNode.replaceChild(newInstantBtn, this.dom.evalInstantBtn);
                    
                    this.dom.evalUnknownBtn = newUnknownBtn;
                    this.dom.evalInstantBtn = newInstantBtn;
                    
                    this.dom.evalUnknownBtn.addEventListener('click', (e) => {
                        console.log('Unknown button clicked');
                        e.preventDefault();
                        e.stopPropagation();
                        this.handleEvaluation('unknown');
                    });
                    
                    this.dom.evalInstantBtn.addEventListener('click', (e) => {
                        console.log('Instant button clicked');
                        e.preventDefault();
                        e.stopPropagation();
                        this.handleEvaluation('instant');
                    });
                },

                handleEvaluation(type) {
                    // è©•ä¾¡ãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ã—ã¦é‡è¤‡ã‚¯ãƒªãƒƒã‚¯ã‚’é˜²ã
                    this.dom.evalUnknownBtn.disabled = true;
                    this.dom.evalInstantBtn.disabled = true;
                    
                    this.evaluate(type);
                    
                    // 200mså¾Œã«ãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
                    setTimeout(() => {
                        this.dom.evalUnknownBtn.disabled = false;
                        this.dom.evalInstantBtn.disabled = false;
                    }, 200);
                },

                startTimer() {
                    this.state.startTime = Date.now();
                    this.state.studyTimer = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - this.state.startTime) / 1000);
                        const minutes = Math.floor(elapsed / 60);
                        const seconds = elapsed % 60;
                        this.dom.studyTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    }, 1000);
                },

                stopTimer() {
                    if (this.state.studyTimer) {
                        clearInterval(this.state.studyTimer);
                        this.state.studyTimer = null;
                    }
                },

                loadMemoryData() {
                    let savedData;
                    try {
                        savedData = JSON.parse(localStorage.getItem(this.config.STORAGE_KEY));
                        if (!Array.isArray(savedData) || savedData.length !== this.state.cardData.length) {
                            savedData = null;
                        }
                    } catch (e) { 
                        savedData = null; 
                    }
                    
                    this.state.cardMemory = savedData || this.state.cardData.map(c => ({
                        id: c.id,
                        level: this.config.MEMORY_LEVELS.UNKNOWN,
                        lastReview: 0,
                        nextReview: 0
                    }));
                    this.saveMemoryData();
                },

                saveMemoryData() {
                    localStorage.setItem(this.config.STORAGE_KEY, JSON.stringify(this.state.cardMemory));
                },

                resetProgress() {
                    if (confirm('âš ï¸ ã™ã¹ã¦ã®å­¦ç¿’è¨˜éŒ²ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                        this.state.cardMemory = this.state.cardData.map(c => ({
                            id: c.id,
                            level: this.config.MEMORY_LEVELS.UNKNOWN,
                            lastReview: 0,
                            nextReview: 0
                        }));
                        this.saveMemoryData();
                        this.updateDashboard();
                        alert('å­¦ç¿’è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
                    }
                },

                updateDashboard() {
                    document.getElementById('total-value').textContent = this.state.cardData.length;
                    const memorizedCount = this.state.cardMemory.filter(m => m.level >= this.config.MEMORY_LEVELS.MEMORIZED).length;
                    const remainingCount = this.state.cardData.length - memorizedCount;
                    const progressPercentage = Math.round((memorizedCount / this.state.cardData.length) * 100);
                    
                    document.getElementById('remaining-value').textContent = remainingCount;
                    document.getElementById('memorized-value').textContent = memorizedCount;
                    document.getElementById('memory-percentage').textContent = progressPercentage + '%';
                },

                showDashboard() {
                    this.dom.dashboard.style.display = 'flex';
                    this.dom.studyScreen.style.display = 'none';
                    this.stopTimer();
                    this.updateDashboard();
                },

                startUltraSpeed() {
                    this.state.currentMode = 'ultra';
                    const unknownCards = this.state.cardMemory.filter(m => m.level === this.config.MEMORY_LEVELS.UNKNOWN);
                    
                    if (unknownCards.length === 0) {
                        alert("ğŸ‰ å…¨å•é¡Œã‚’å­¦ç¿’æ¸ˆã¿ã§ã™ï¼é–“éš”åå¾©å¾©ç¿’ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚");
                        return;
                    }

                    this.state.studyQueue = this.shuffleArray(unknownCards.map(c => c.id));
                    this.state.currentIndex = 0;
                    this.startStudySession();
                },

                startSpacedReview() {
                    this.state.currentMode = 'spaced';
                    const now = Date.now();
                    const reviewCards = this.state.cardMemory.filter(m => 
                        m.level > this.config.MEMORY_LEVELS.UNKNOWN && 
                        m.level < this.config.MEMORY_LEVELS.MEMORIZED &&
                        m.nextReview <= now
                    );
                    
                    if (reviewCards.length === 0) {
                        alert("ğŸ‰ å¾©ç¿’ã®å¿…è¦ãªã‚«ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ï¼æ–°ã—ã„å­¦ç¿’ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚");
                        return;
                    }

                    this.state.studyQueue = reviewCards.map(c => c.id);
                    this.state.currentIndex = 0;
                    this.startStudySession();
                },

                startStudySession() {
                    this.dom.dashboard.style.display = 'none';
                    this.dom.studyScreen.style.display = 'flex';
                    this.startTimer();
                    this.renderCard(this.state.studyQueue[0]);
                },

                createInterleavedQueue(cardIds) {
                    const groupedByTopic = {};
                    cardIds.forEach(id => {
                        const topic = this.state.cardData[id].topic.split('/')[0];
                        if (!groupedByTopic[topic]) groupedByTopic[topic] = [];
                        groupedByTopic[topic].push(id);
                    });

                    for (const topic in groupedByTopic) this.shuffleArray(groupedByTopic[topic]);

                    const interleavedQueue = [];
                    const topics = Object.keys(groupedByTopic);
                    let lastTopic = null;

                    while (interleavedQueue.length < cardIds.length) {
                        let availableTopics = topics.filter(t => groupedByTopic[t].length > 0 && t !== lastTopic);
                        if (availableTopics.length === 0) {
                            availableTopics = topics.filter(t => groupedByTopic[t].length > 0);
                        }
                        const nextTopic = availableTopics[Math.floor(Math.random() * availableTopics.length)];
                        interleavedQueue.push(groupedByTopic[nextTopic].shift());
                        lastTopic = nextTopic;
                    }
                    return interleavedQueue;
                },

                renderCard(cardId) {
                    this.state.currentCard = this.state.cardData.find(c => c.id === cardId);
                    const { topic, q, a } = this.state.currentCard;
                    const memory = this.state.cardMemory.find(m => m.id === cardId);
                    
                    // ã‚«ãƒ¼ãƒ‰é–‹å§‹æ™‚é–“ã‚’è¨˜éŒ²ï¼ˆå­¦ç¿’æ™‚é–“è¿½è·¡ç”¨ï¼‰
                    this.state.cardStartTime = Date.now();

                    // ç§‘å­¦çš„æš—è¨˜æ”¯æ´ï¼šæ€ã„å‡ºã—ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆãƒ†ã‚¹ãƒˆåŠ¹æœï¼‰
                    const shouldDoRecallTest = Math.random() < this.config.RECALL_TEST_PROBABILITY;
                    
                    // è¨˜æ†¶ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºæ›´æ–°
                    this.updateMemoryIndicator(memory.level);
                    
                    this.dom.frontTopicTag.textContent = topic;
                    this.dom.backTopicTag.textContent = topic;
                    
                    if (shouldDoRecallTest && this.state.currentMode === 'ultra') {
                        this.dom.question.innerHTML = `
                            <div class="recall-test">
                                <div class="recall-prompt">ğŸ§  ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒªã‚³ãƒ¼ãƒ«</div>
                                <div class="recall-question">ã¾ãšç­”ãˆã‚’æ€ã„æµ®ã‹ã¹ã¦ãã ã•ã„ï¼š<br><strong>ã€Œ${q}ã€</strong></div>
                                <div class="recall-hint">ï¼ˆ3ç§’å¾Œã«é€šå¸¸å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
                                <div class="recall-benefit">â€»æ€ã„å‡ºã™ãƒ—ãƒ­ã‚»ã‚¹ãŒè¨˜æ†¶ã‚’å¼·åŒ–ã—ã¾ã™</div>
                            </div>
                        `;
                        setTimeout(() => {
                            this.dom.question.textContent = q;
                        }, 3000); // 3ç§’ã«çŸ­ç¸®
                    } else {
                        this.dom.question.textContent = q;
                    }
                    
                    // è¨˜æ†¶ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆãƒ‡ãƒ¥ã‚¢ãƒ«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç†è«–ï¼‰
                    const difficultyLevel = this.getDifficultyLevel(memory.level);
                    this.dom.card.style.borderLeft = `5px solid ${this.config.VISUAL_CUES.DIFFICULTY_COLORS[difficultyLevel]}`;
                    this.dom.card.style.backgroundColor = this.getCardBackgroundColor(memory.level);
                    
                    this.dom.answer.innerHTML = a;

                    // é€²æ—æƒ…å ±æ›´æ–°
                    this.dom.progressInfo.textContent = `æ®‹ã‚Š ${this.state.studyQueue.length - this.state.currentIndex} å• (é€²æ—: ${Math.round((this.state.currentIndex / this.state.studyQueue.length) * 100)}%)`;

                    // ã‚«ãƒ¼ãƒ‰çŠ¶æ…‹ã®å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
                    this.dom.card.classList.remove('is-flipped');
                    this.dom.evalContainer.classList.remove('show');
                    this.dom.evalStep1.classList.remove('active');
                    
                    // ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
                    this.dom.speedIndicator.style.background = 'var(--success-color)';
                    
                    // è¶…é«˜é€Ÿãƒ¢ãƒ¼ãƒ‰ã§ã¯è‡ªå‹•ã§ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼è¨­å®šï¼‰
                    if (this.state.currentMode === 'ultra') {
                        const flipDuration = shouldDoRecallTest ? 
                            this.config.ULTRA_SPEED_DURATION + 3000 : // ãƒªã‚³ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã®å ´åˆã¯+3ç§’
                            this.config.ULTRA_SPEED_DURATION;
                        this.startAutoFlip(flipDuration);
                    } else {
                        // é–“éš”åå¾©ãƒ¢ãƒ¼ãƒ‰ã§ã¯æ‰‹å‹•ãƒ•ãƒªãƒƒãƒ—
                        this.dom.speedIndicator.textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦ç­”ãˆã‚’ç¢ºèª';
                        this.dom.speedIndicator.style.background = 'var(--primary-color)';
                    }
                },

                updateMemoryIndicator(level) {
                    this.dom.memoryIndicator.className = `memory-level-indicator memory-level-${level}`;
                    const levelNames = ['æœªçŸ¥', 'å­¦ç¿’ä¸­', 'æ…£ã‚ŒãŸ', 'è¨˜æ†¶æ¸ˆã¿'];
                    this.dom.memoryIndicator.title = `è¨˜æ†¶ãƒ¬ãƒ™ãƒ«: ${levelNames[level]}`;
                },

                getCardBackgroundColor(level) {
                    const baseColor = 'var(--card-bg)';
                    const levelColors = {
                        0: 'linear-gradient(135deg, var(--card-bg) 0%, rgba(255, 68, 68, 0.1) 100%)',
                        1: 'linear-gradient(135deg, var(--card-bg) 0%, rgba(255, 136, 0, 0.1) 100%)',
                        2: 'linear-gradient(135deg, var(--card-bg) 0%, rgba(68, 170, 68, 0.1) 100%)',
                        3: 'linear-gradient(135deg, var(--card-bg) 0%, rgba(0, 136, 255, 0.1) 100%)'
                    };
                    return levelColors[level] || baseColor;
                },

                getDifficultyLevel(memoryLevel) {
                    if (memoryLevel <= this.config.MEMORY_LEVELS.UNKNOWN) return 'hard';
                    if (memoryLevel <= this.config.MEMORY_LEVELS.LEARNING) return 'medium';
                    return 'easy';
                },

                startAutoFlip(duration = this.config.ULTRA_SPEED_DURATION) {
                    let countdown = Math.floor(duration / 1000);
                    
                    // ã‚ˆã‚Šè¦ªåˆ‡ãªã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º
                    this.dom.speedIndicator.textContent = `è€ƒãˆã‚‹æ™‚é–“: ${countdown}ç§’`;
                    this.dom.speedIndicator.className = 'speed-indicator ultra-fast';
                    
                    // ãƒ•ã‚§ãƒ¼ã‚ºè¡¨ç¤ºã‚’è¿½åŠ 
                    const phases = {
                        reading: Math.floor(countdown * 0.4),  // èª­è§£ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆ40%ï¼‰
                        thinking: Math.floor(countdown * 0.6)  // æ€è€ƒãƒ•ã‚§ãƒ¼ã‚ºï¼ˆ60%ï¼‰
                    };
                    
                    const timer = setInterval(() => {
                        countdown--;
                        
                        if (countdown > phases.thinking) {
                            this.dom.speedIndicator.textContent = `ğŸ“– èª­è§£æ™‚é–“: ${countdown}ç§’`;
                            this.dom.speedIndicator.style.background = 'var(--primary-color)';
                        } else if (countdown > 0) {
                            this.dom.speedIndicator.textContent = `ğŸ¤” æ€è€ƒæ™‚é–“: ${countdown}ç§’`;
                            this.dom.speedIndicator.style.background = 'var(--warning-color)';
                        } else {
                            this.dom.speedIndicator.textContent = 'âœ… ç­”ãˆç¢ºèª';
                            this.dom.speedIndicator.style.background = 'var(--success-color)';
                        }
                        
                        if (countdown === 0) {
                            clearInterval(timer);
                            this.flipCard();
                        }
                    }, 1000);
                },

                flipCard() {
                    if (this.dom.card.classList.contains('is-flipped')) return;
                    this.dom.card.classList.add('is-flipped');
                    
                    // ç§‘å­¦çš„æš—è¨˜æ”¯æ´ï¼šè‡ªå·±èª¬æ˜ä¿ƒé€²æ©Ÿèƒ½ï¼ˆç²¾ç·»åŒ–ãƒªãƒãƒ¼ã‚µãƒ«ï¼‰
                    const memory = this.state.cardMemory.find(m => m.id === this.state.currentCard.id);
                    const shouldPromptExplanation = memory.level <= this.config.MEMORY_LEVELS.LEARNING && 
                        Math.random() < this.config.ELABORATIVE_REHEARSAL_CHANCE;
                    
                    if (shouldPromptExplanation) {
                        const prompt = this.config.SELF_EXPLANATION_PROMPTS[
                            Math.floor(Math.random() * this.config.SELF_EXPLANATION_PROMPTS.length)
                        ];
                        this.showSelfExplanationPrompt(prompt);
                    }
                    
                    this.dom.speedIndicator.textContent = 'ğŸ’¡ è¨˜æ†¶ã‚’å®šç€ã•ã›ã¦ã„ã¾ã™...';
                    this.dom.speedIndicator.style.background = 'var(--success-color)';
                    
                    // è©•ä¾¡ãƒœã‚¿ãƒ³ã‚’ç´ æ—©ãè¡¨ç¤ºã™ã‚‹ãŸã‚ã®å‡¦ç†
                    setTimeout(() => {
                        this.showEvaluationButtons();
                    }, 1000); // 1ç§’å¾Œã«ç´ æ—©ãè¡¨ç¤º
                },

                showEvaluationButtons() {
                    // è©•ä¾¡ãƒœã‚¿ãƒ³ã®ç¢ºå®Ÿãªè¡¨ç¤º
                    this.dom.evalContainer.classList.add('show');
                    this.dom.evalStep1.classList.add('active');
                    console.log('Evaluation buttons shown');
                    
                    // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®æ›´æ–°
                    this.dom.speedIndicator.textContent = 'âš¡ è©•ä¾¡ã—ã¦ãã ã•ã„';
                    this.dom.speedIndicator.style.background = 'var(--warning-color)';
                },

                getAnswerDisplayTime(memoryLevel) {
                    // ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼è¨­å®šï¼šè¨˜æ†¶ãƒ¬ãƒ™ãƒ«ãŒä½ã„ã»ã©å°‘ã—é•·ãè¡¨ç¤º
                    const baseTimes = [4000, 3000, 2000, 1500]; // ãƒ¬ãƒ™ãƒ«åˆ¥è¡¨ç¤ºæ™‚é–“ï¼ˆé«˜é€ŸåŒ–ï¼‰
                    return baseTimes[memoryLevel] || 2000;
                },

                scheduleEvaluationPrompt(delay) {
                    setTimeout(() => {
                        this.showEvaluationButtons();
                    }, delay);
                },

                showSelfExplanationPrompt(prompt) {
                    const explanationDiv = document.createElement('div');
                    explanationDiv.className = 'self-explanation-prompt';
                    explanationDiv.innerHTML = `
                        <div class="explanation-header">ğŸ¯ è¨˜æ†¶å¼·åŒ–ã‚¿ã‚¤ãƒ </div>
                        <div class="explanation-text">${prompt}</div>
                        <div class="explanation-timer">
                            <div class="timer-bar">
                                <div class="timer-fill"></div>
                            </div>
                            æ€è€ƒä¸­... ã“ã®æ™‚é–“ãŒè¨˜æ†¶ã‚’å¼·åŒ–ã—ã¾ã™
                        </div>
                    `;
                    
                    this.dom.answer.appendChild(explanationDiv);
                    
                    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã‚¿ã‚¤ãƒãƒ¼ãƒãƒ¼ï¼ˆé«˜é€ŸåŒ–ï¼‰
                    const timerFill = explanationDiv.querySelector('.timer-fill');
                    if (timerFill) {
                        timerFill.style.animation = 'timer-progress 5s linear forwards';
                    }
                    
                    setTimeout(() => {
                        if (explanationDiv.parentNode) {
                            explanationDiv.style.opacity = '0';
                            explanationDiv.style.transform = 'translateY(-20px)';
                            setTimeout(() => explanationDiv.remove(), 200);
                        }
                    }, 5000); // 5ç§’ã«çŸ­ç¸®
                },

                evaluate(type) {
                    console.log('Evaluate called with type:', type);
                    const cardMemory = this.state.cardMemory.find(m => m.id === this.state.currentCard.id);
                    const now = Date.now();
                    
                    // ç§‘å­¦çš„è¨˜æ†¶è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ 
                    if (type === 'instant') {
                        // ç¬æ™‚ã«ç­”ãˆãŒæµ®ã‹ã‚“ã å ´åˆï¼ˆæµæš¢æ€§åŠ¹æœï¼‰
                        cardMemory.level = Math.min(cardMemory.level + 1, this.config.MEMORY_LEVELS.MEMORIZED);
                        cardMemory.confidenceScore = (cardMemory.confidenceScore || 0) + 0.3;
                        
                        if (cardMemory.level < this.config.MEMORY_LEVELS.MEMORIZED) {
                            // æ¬¡ã®å¾©ç¿’æ™‚é–“ã‚’è¨­å®šï¼ˆæ”¹è‰¯ã•ã‚ŒãŸé–“éš”åå¾©ï¼‰
                            const intervalMinutes = this.config.SPACED_INTERVALS[cardMemory.level - 1] || 60;
                            cardMemory.nextReview = now + (intervalMinutes * 60 * 1000);
                        }
                        
                        // ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                        this.showFeedback('âœ… ç´ æ™´ã‚‰ã—ã„ï¼è¨˜æ†¶ãŒå®šç€ã—ã¦ã„ã¾ã™', 'success');
                        
                    } else if (type === 'unknown') {
                        // åˆ†ã‹ã‚‰ãªã‹ã£ãŸå ´åˆï¼ˆå¿˜å´æ›²ç·šå¯¾ç­–ï¼‰
                        cardMemory.level = Math.max(cardMemory.level - 1, this.config.MEMORY_LEVELS.UNKNOWN);
                        cardMemory.confidenceScore = Math.max((cardMemory.confidenceScore || 0) - 0.2, 0);
                        cardMemory.nextReview = now + (2 * 60 * 1000); // 2åˆ†å¾Œã«å†å¾©ç¿’
                        
                        // å­¦ç¿’ä¿ƒé€²ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                        this.showFeedback('ğŸ“š å¤§ä¸ˆå¤«ï¼å†å­¦ç¿’ã§è¨˜æ†¶ã‚’å¼·åŒ–ã—ã¾ã™', 'info');
                    }
                    
                    // ãƒ¡ã‚¿èªçŸ¥è¿½è·¡
                    cardMemory.reviewCount = (cardMemory.reviewCount || 0) + 1;
                    cardMemory.lastReview = now;
                    cardMemory.totalStudyTime = (cardMemory.totalStudyTime || 0) + 
                        (now - (this.state.cardStartTime || now));
                    
                    this.saveMemoryData();
                    this.proceedToNextCard();
                },

                showFeedback(message, type) {
                    const feedbackDiv = document.createElement('div');
                    feedbackDiv.className = `feedback-message ${type}`;
                    feedbackDiv.textContent = message;
                    
                    document.body.appendChild(feedbackDiv);
                    
                    setTimeout(() => {
                        feedbackDiv.style.opacity = '0';
                        feedbackDiv.style.transform = 'translateY(-20px)';
                        setTimeout(() => feedbackDiv.remove(), 300);
                    }, 2000);
                },

                proceedToNextCard() {
                    this.state.currentIndex++;
                    
                    // è©•ä¾¡ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºå®Ÿã«éè¡¨ç¤ºã«ã™ã‚‹
                    this.dom.evalContainer.classList.remove('show');
                    this.dom.evalStep1.classList.remove('active');
                    
                    // ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
                    this.dom.speedIndicator.textContent = 'æ¬¡ã®ã‚«ãƒ¼ãƒ‰ã‚’æº–å‚™ä¸­...';
                    this.dom.speedIndicator.style.background = 'var(--primary-color)';

                    if (this.state.currentIndex < this.state.studyQueue.length) {
                        const nextCardId = this.state.studyQueue[this.state.currentIndex];
                        
                        // ã‚«ãƒ¼ãƒ‰é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé«˜é€ŸåŒ–ï¼‰
                        this.dom.cardInner.style.opacity = 0;
                        this.dom.cardInner.style.transform = 'scale(0.95)';
                        
                        setTimeout(() => {
                            this.renderCard(nextCardId);
                            this.dom.cardInner.style.opacity = 1;
                            this.dom.cardInner.style.transform = 'scale(1)';
                        }, 100); // 100msã§è¶…é«˜é€ŸåŒ–
                    } else {
                        // ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†å‡¦ç†
                        setTimeout(() => {
                            this.showSessionResults();
                        }, 300);
                    }
                },

                showSessionResults() {
                    const memorizedCount = this.state.cardMemory.filter(m => m.level >= this.config.MEMORY_LEVELS.MEMORIZED).length;
                    const totalTime = Math.floor((Date.now() - this.state.startTime) / 1000);
                    const minutes = Math.floor(totalTime / 60);
                    const seconds = totalTime % 60;
                    const progressPercentage = Math.round((memorizedCount / this.state.cardData.length) * 100);
                    
                    let message = "ğŸ‰ å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†ï¼\n\n";
                    message += `å­¦ç¿’æ™‚é–“: ${minutes}åˆ†${seconds}ç§’\n`;
                    message += `è¨˜æ†¶ç‡: ${progressPercentage}%\n`;
                    message += `è¨˜æ†¶æ¸ˆã¿: ${memorizedCount}å•\n\n`;
                    
                    if (this.state.currentMode === 'ultra') {
                        message += "æ¬¡ã¯é–“éš”åå¾©å¾©ç¿’ã§è¨˜æ†¶ã‚’å®šç€ã•ã›ã¾ã—ã‚‡ã†ï¼";
                    } else {
                        message += "ç´ æ™´ã‚‰ã—ã„ï¼ç¶™ç¶šçš„ãªå¾©ç¿’ã§é•·æœŸè¨˜æ†¶ã«ç§»è¡Œä¸­ã§ã™ï¼";
                    }
                    
                    alert(message);
                    this.showDashboard();
                },

                shuffleArray(array) {
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                    return array;
                }
            };

            App.init();
        });
    </script>
</body>

</html>